<link rel="import" href="bower_components/polymer/polymer-element.html">
<link rel="import" href="bower_components/polymer/polymer.html">
<link rel="import" href="lazy-import.html">

<dom-module id="image-upload">
  <template>
    <style media="screen">
      :host {
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        margin: 0;
        padding: 0;
        min-height: 100px;
        width: 100%;
      }
      progress{
        width: 100%;
        margin-bottom: 5px;
        -webkit-appearance:none;
        appearance:none;
      }
    </style>

    <progress id="upProg" value="0" max="100">0%</progress>
    <input id="fileButt" type="file" value="upload" accept="[[fileType]]" />
  </template>

  <script>

  /*
  var configFirebase = {
            //app_name: "bizrec-dev",
            authDomain: "bizrec-dev.firebaseapp.com",
            databaseURL: "https://bizrec-dev.firebaseio.com/",
            apiKey: "AIzaSyAareWgpGBiGzv5PE_Z21jnaYmRpfYx9H8",
            storageBucket: "bizrec-dev.appspot.com",
            messagingSenderId: "531391633867",
  };


  //firebase.initializeApp(configFirebase);

  var uploader = document.getElementById('upProg');
  var fileButt = document.getElementById('fileButt');
  console.log(fileButt);

  fileButt.addEventListner('change',
      function(e) {
        //get file
        var file = e.target.files(0);

        //create storage
        var storageRef = firebase.storage().ref(''+user.uid+'/'+'img'+'/'+file.name);

        //upload file
        var task = storageRef.put(file);

        //update progressbar
        task.on('state_changed',
            function progress(snapshot){
              uploader.value = 100 * (snapshot.bytesTransferred / snapshot.totalBytes);
            },
            function error(err){
              console.log('Error: ' + err.code);
            },
            function complete(){
              console.log('Complete: '+ dest);
            }
        );

      }
    );
    */

    class ImageUpload extends Polymer.Element {
      static get is() { return 'image-upload'; }

      ready() {
        super.ready();
        this.$.fileButt.addEventListener('change', e => {this.handleFile(e)});
      }

      static get properties() {
        return {
          user: {
            type: Object,
          },
          signedin: {
            type: Boolean,
          },
          appName:{
            type: String,
            value:'app'
          },
          directory:{
            type: String,
            value:'img/'
          },
          storedName:{
            type: String,
            value:''
          },
          fileType:{
            type: String,
            value:'image/*'
          },
          listeners:{
            'fileButt.change':'handleFile',
            'uploader':''
          }
        };
      }

      handleFile(e) {
           console.info(e.target.id + ' was clicked.');

           var upProgVar = this.$.upProg;
           console.log('upProgVar ->' + upProgVar);

            //get file
            var file = e.target.files[0];
            console.log('file ->' + file);

            //create storage
            var storageRef = firebase.storage().ref('USR_'+this.user.uid+'/'+'img'+'/'+file.name);

            //upload file
            var task = storageRef.put(file);

            //update progressbar
            task.on('state_changed',
                function progress(snapshot){
                  upProgVar.value = 100 * (snapshot.bytesTransferred / snapshot.totalBytes);
                },
                function error(err){
                  console.log('Error: ' + err.code);
                },
                function complete(){
                  console.log('Complete: uploading'+ upProgVar.value);
                }
            );

          }

    }//end polymer

    window.customElements.define(ImageUpload.is, ImageUpload);
  </script>
</dom-module>
